---
layout: blog-base.njk
title: Blog
description: Stories, history, and dispatches from the Caribbean islands — written by Quincy.
permalink: /blog/
---

{% set posts = collections.post %}

<section class="blog-hero">
  <div class="container">
    <p class="section-label">Stories & Culture</p>
    <h1 class="section-title">The <span class="text-gold">Blog</span></h1>
    <p class="blog-intro">Stories, history, and dispatches from the islands — written by Quincy.</p>
  </div>
</section>

<section class="blog-posts">
  <div class="container">

    {% if posts.length %}
    <div class="post-filters" id="post-filters" hidden>
      <div class="filter-chips" id="filter-chips"></div>
    </div>
    <div class="post-grid" id="post-grid">
      {% for post in posts %}
      <article class="post-card{% if post.data.featuredImage %} has-image{% endif %}{% if post.data.featured %} is-featured{% endif %}"
        data-category="{{ post.data.category or '' }}"
        data-tags="{{ post.data.postTags | join(' ') if post.data.postTags else '' }}">
        {% if post.data.featuredImage %}
        <a href="{{ post.url }}" class="post-card-image" tabindex="-1" aria-hidden="true">
          <img src="{{ post.data.featuredImage }}" alt="{{ post.data.title }}" loading="lazy">
        </a>
        {% endif %}
        <div class="post-card-body">
          <div class="post-card-meta">
            {% if post.data.category %}<span class="post-category-badge">{{ post.data.category | categoryLabel }}</span>{% endif %}
            {% if post.data.featured %}<span class="post-featured-badge">Featured</span>{% endif %}
          </div>
          <time class="post-date" datetime="{{ post.date | htmlDateString }}">{{ post.date | readableDate }}</time>
          <h2 class="post-card-title">
            <a href="{{ post.url }}">{{ post.data.title }}</a>
          </h2>
          {% if post.data.excerpt %}
          <p class="post-excerpt">{{ post.data.excerpt | truncateWords(30) }}</p>
          {% endif %}
          <a href="{{ post.url }}" class="post-link">
            Read more
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
          </a>
        </div>
      </article>
      {% endfor %}
    </div>

    {% else %}
    <p class="no-posts">No posts yet. Check back soon.</p>
    {% endif %}

  </div>
</section>

<script>
(function () {
  var cards = Array.from(document.querySelectorAll('#post-grid .post-card'));
  if (!cards.length) return;

  var CATEGORY_LABELS = {
    culture: 'Culture & Heritage',
    history: 'History',
    travel:  'Travel & Expat',
    food:    'Food & Traditions',
    music:   'Music & Arts',
    news:    'News & Updates'
  };

  // Collect unique categories and tags from rendered cards
  var categories = [], tags = [];
  cards.forEach(function (card) {
    var cat = card.dataset.category;
    if (cat && categories.indexOf(cat) === -1) categories.push(cat);
    var cardTags = card.dataset.tags ? card.dataset.tags.split(' ').filter(Boolean) : [];
    cardTags.forEach(function (tag) {
      if (tags.indexOf(tag) === -1) tags.push(tag);
    });
  });

  if (!categories.length && !tags.length) return;

  var container = document.getElementById('filter-chips');
  var filterBar  = document.getElementById('post-filters');
  var activeValue = null;
  var activeType  = null;

  function buildChip(value, label, type) {
    var btn = document.createElement('button');
    btn.className = 'filter-chip';
    btn.textContent = label;
    btn.dataset.value = value;
    btn.dataset.type  = type;
    btn.addEventListener('click', function () {
      if (activeValue === value && activeType === type) {
        activeValue = null; activeType = null;
      } else {
        activeValue = value; activeType = type;
      }
      applyFilter();
    });
    return btn;
  }

  function applyFilter() {
    container.querySelectorAll('.filter-chip').forEach(function (btn) {
      btn.classList.toggle('is-active',
        btn.dataset.value === activeValue && btn.dataset.type === activeType);
    });
    cards.forEach(function (card) {
      var show = true;
      if (activeValue) {
        if (activeType === 'category') {
          show = card.dataset.category === activeValue;
        } else {
          var t = card.dataset.tags ? card.dataset.tags.split(' ') : [];
          show = t.indexOf(activeValue) !== -1;
        }
      }
      card.style.display = show ? '' : 'none';
    });
  }

  // Build category chips
  if (categories.length) {
    var catSep = document.createElement('span');
    catSep.className = 'filter-section-label';
    catSep.textContent = 'Category';
    container.appendChild(catSep);
    categories.forEach(function (cat) {
      container.appendChild(buildChip(cat, CATEGORY_LABELS[cat] || cat, 'category'));
    });
  }

  // Build tag chips
  if (tags.length) {
    var tagSep = document.createElement('span');
    tagSep.className = 'filter-section-label';
    tagSep.textContent = 'Tags';
    container.appendChild(tagSep);
    tags.forEach(function (tag) {
      var label = tag.charAt(0).toUpperCase() + tag.slice(1);
      container.appendChild(buildChip(tag, label, 'tag'));
    });
  }

  filterBar.removeAttribute('hidden');
})();
</script>
